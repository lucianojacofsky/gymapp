<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>GymLoad Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <style>
    :root {
      --bg: #0b0c10;
      --bg-alt: #13141a;
      --card: #181b25;
      --text: #f5f5f5;
      --muted: #9ca3af;
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.15);
      --border: #2d3250;
    }
    [data-theme="light"] {
      --bg: #f3f4f6;
      --bg-alt: #e5e7eb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.08);
      --border: #d1d5db;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 1rem 1.25rem 0.5rem;
      background: linear-gradient(120deg, var(--bg-alt), var(--bg));
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header h1 {
      font-size: 1.3rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    header h1 span.logo-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px var(--accent);
    }

    header .subtitle {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 0.15rem;
    }

    main {
      flex: 1;
      padding: 0.75rem 1.25rem 4.5rem;
    }

    .tabs {
      display: flex;
      gap: 0.4rem;
      margin-top: 0.75rem;
    }

    .tab-btn {
      flex: 1;
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 0.35rem 0.5rem;
      font-size: 0.8rem;
      cursor: pointer;
      background: transparent;
      color: var(--muted);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
    }

    .tab-btn.active {
      background: var(--accent-soft);
      color: var(--accent);
      border-color: var(--accent);
    }

    .tab-btn span.icon {
      font-size: 0.9rem;
    }

    .section {
      display: none;
      animation: fadeIn 0.18s ease-out;
    }
    .section.active { display: block; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 1rem;
      margin-top: 0.8rem;
      border: 1px solid var(--border);
      box-shadow: 0 10px 25px rgba(0,0,0,0.25);
    }

    .card h2 {
      font-size: 0.95rem;
      margin-bottom: 0.6rem;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .card h2 span.icon {
      font-size: 1rem;
    }

    .label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: var(--muted);
      margin-bottom: 0.2rem;
    }

    .field-row {
      display: flex;
      gap: 0.6rem;
      margin-bottom: 0.6rem;
    }

    .field {
      flex: 1;
    }

    input, select {
      width: 100%;
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 0.5rem 0.55rem;
      font-size: 0.85rem;
      background: var(--bg-alt);
      color: var(--text);
      outline: none;
    }

    input:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .slider-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
    }

    .slider-row input[type="range"] {
      flex: 1;
    }

    .slider-value {
      font-size: 0.8rem;
      color: var(--muted);
      min-width: 2.3rem;
      text-align: right;
    }

    .btn {
      width: 100%;
      border-radius: 999px;
      padding: 0.55rem;
      border: none;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      margin-top: 0.4rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .small {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .result {
      margin-top: 0.4rem;
      font-size: 0.9rem;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      border-radius: 999px;
      padding: 0.15rem 0.45rem;
      font-size: 0.7rem;
      background: var(--bg-alt);
      color: var(--muted);
    }

    .pr-list {
      margin-top: 0.4rem;
      max-height: 260px;
      overflow-y: auto;
    }

    .pr-item {
      padding: 0.45rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.03);
      display: flex;
      justify-content: space-between;
      font-size: 0.82rem;
    }

    .pr-item:last-child { border-bottom: none; }

    .badge {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      padding: 0.12rem 0.4rem;
      font-size: 0.7rem;
      background: var(--accent-soft);
      color: var(--accent);
      gap: 0.25rem;
    }

    .pill-group {
      display: flex;
      gap: 0.35rem;
      margin-top: 0.35rem;
      flex-wrap: wrap;
    }

    .pill {
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 0.7rem;
      color: var(--muted);
      background: transparent;
      cursor: pointer;
    }

    footer.navbar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(10,10,14,0.95);
      border-top: 1px solid var(--border);
      backdrop-filter: blur(18px);
      padding-bottom: env(safe-area-inset-bottom);
    }

    .nav-inner {
      max-width: 480px;
      margin: 0 auto;
      display: flex;
      justify-content: space-around;
      padding: 0.3rem 0.75rem 0.6rem;
      gap: 0.4rem;
    }

    .nav-btn {
      flex: 1;
      border-radius: 999px;
      padding: 0.25rem 0.4rem;
      font-size: 0.7rem;
      border: none;
      background: transparent;
      color: var(--muted);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.1rem;
      cursor: pointer;
    }

    .nav-btn.active {
      background: var(--accent-soft);
      color: var(--accent);
    }

    .nav-btn span.icon {
      font-size: 1rem;
    }

    @media (min-width: 600px) {
      main {
        padding-bottom: 2.5rem;
      }
    }
  </style>
</head>
<body>
<div class="app" id="app" data-theme="dark">
  <header>
    <h1><span class="logo-dot"></span>GymLoad <span style="font-weight:400;font-size:0.8rem;color:var(--muted)">web</span></h1>
    <div class="subtitle">Calculadora de cargas + PR + historial, todo guardado en tu celu.</div>
    <div class="tabs">
      <button class="tab-btn active" data-tab="today"><span class="icon">‚òÄÔ∏è</span>Hoy</button>
      <button class="tab-btn" data-tab="loads"><span class="icon">üèãÔ∏è‚Äç‚ôÇÔ∏è</span>Cargas</button>
      <button class="tab-btn" data-tab="prs"><span class="icon">üèÖ</span>PR / Historial</button>
      <button class="tab-btn" data-tab="profile"><span class="icon">üë§</span>Perfil</button>
    </div>
  </header>

  <main>
    <!-- HOY -->
    <section class="section active" id="section-today">
      <div class="card">
        <h2><span class="icon">üß†</span>Estado de hoy</h2>
        <div class="label">Energ√≠a</div>
        <div class="slider-row">
          <input type="range" min="1" max="5" step="0.5" value="3" id="energy">
          <div class="slider-value" id="energy-val">3.0</div>
        </div>

        <div class="label">Estr√©s</div>
        <div class="slider-row">
          <input type="range" min="1" max="5" step="0.5" value="3" id="stress">
          <div class="slider-value" id="stress-val">3.0</div>
        </div>

        <div class="label">Sue√±o</div>
        <div class="slider-row">
          <input type="range" min="1" max="5" step="0.5" value="3" id="sleep">
          <div class="slider-value" id="sleep-val">3.0</div>
        </div>

        <div class="label" style="margin-top:0.4rem;">Sugerencia del d√≠a</div>
        <div id="suggestion" class="result small"></div>
      </div>
      <div class="card">
        <h2><span class="icon">üìå</span>Tip</h2>
        <div class="small">
          Agreg√° esta p√°gina a la pantalla de inicio del iPhone:  
          Compartir ‚Üí <strong>"A√±adir a pantalla de inicio"</strong>.  
          Te queda como una app.
        </div>
      </div>
    </section>

    <!-- CARGAS -->
    <section class="section" id="section-loads">
      <div class="card">
        <h2><span class="icon">üèãÔ∏è‚Äç‚ôÄÔ∏è</span>Calculadora de cargas</h2>
        <div class="label">Ejercicio</div>
        <input id="exercise" type="text" placeholder="Ej: Bench press" value="Bench press">

        <div class="field-row" style="margin-top:0.6rem;">
          <div class="field">
            <div class="label">Peso (kg)</div>
            <input id="weight" type="number" inputmode="decimal" placeholder="Ej: 60">
          </div>
          <div class="field">
            <div class="label">Reps</div>
            <input id="reps" type="number" inputmode="numeric" placeholder="Ej: 8">
          </div>
        </div>

        <div class="label" style="margin-top:0.3rem;">RPE</div>
        <div class="slider-row">
          <input type="range" min="6" max="10" step="0.5" value="8" id="rpe">
          <div class="slider-value" id="rpe-val">8.0</div>
        </div>

        <div class="label" style="margin-top:0.4rem;">Reps objetivo</div>
        <input id="targetReps" type="number" inputmode="numeric" placeholder="Ej: 5" value="8">

        <button class="btn btn-primary" id="btn-calc">
          <span>Calcular</span> <span>‚ö°</span>
        </button>

        <div class="result" id="rm-result"></div>
        <div class="result" id="target-result"></div>

        <button class="btn btn-outline" id="btn-save-pr">
          <span>Guardar serie / PR</span> <span>üèÖ</span>
        </button>
        <div class="small" id="save-msg"></div>
      </div>
    </section>

    <!-- PR + HISTORIAL -->
    <section class="section" id="section-prs">
      <div class="card">
        <h2><span class="icon">üèÖ</span>PR personales</h2>
        <div class="small" id="pr-empty">Todav√≠a no guardaste ning√∫n PR.</div>
        <div class="pr-list" id="pr-list"></div>
      </div>

      <div class="card">
        <h2><span class="icon">üìÖ</span>Historial de series / √∫ltimos entrenos</h2>

        <div class="label">Filtrar por ejercicio</div>
        <select id="history-filter">
          <option value="all">Todos</option>
        </select>
        <div class="small" style="margin-top:0.25rem;">
          El resumen de cada d√≠a se calcula en base al filtro actual.
        </div>

        <div class="small" id="history-empty" style="margin-top:0.5rem;">
          Todav√≠a no registraste ninguna serie.
        </div>
        <div class="pr-list" id="history-list"></div>
      </div>
    </section>

    <!-- PERFIL -->
    <section class="section" id="section-profile">
      <div class="card">
        <h2><span class="icon">üé®</span>Personalizaci√≥n</h2>
        <div class="label">Tema</div>
        <div class="pill-group">
          <button class="pill" data-theme-btn="dark">Oscuro</button>
          <button class="pill" data-theme-btn="light">Claro</button>
        </div>

        <div class="label" style="margin-top:0.8rem;">Recordatorio (simple)</div>
        <div class="field-row">
          <div class="field">
            <div class="label">Hora</div>
            <input id="reminder-time" type="time" value="20:00">
          </div>
        </div>
        <div class="small">
          Esto solo guarda la hora que te gustar√≠a entrenar (para que la veas al entrar).  
          Para notificaciones reales se necesita una configuraci√≥n extra.
        </div>
      </div>
    </section>
  </main>

  <footer class="navbar">
    <div class="nav-inner">
      <button class="nav-btn active" data-tab="today">
        <span class="icon">‚òÄÔ∏è</span>
        <span>Hoy</span>
      </button>
      <button class="nav-btn" data-tab="loads">
        <span class="icon">üèãÔ∏è‚Äç‚ôÇÔ∏è</span>
        <span>Cargas</span>
      </button>
      <button class="nav-btn" data-tab="prs">
        <span class="icon">üèÖ</span>
        <span>PR</span>
      </button>
      <button class="nav-btn" data-tab="profile">
        <span class="icon">üë§</span>
        <span>Perfil</span>
      </button>
    </div>
  </footer>
</div>

<script>
  // ---------- Utilidades fuerza ----------
  function oneRepMax(weight, reps) {
    if (reps <= 0) return 0;
    return weight * (1 + reps / 30.0);
  }
  function weightForReps(oneRM, targetReps) {
    if (targetReps <= 0) return 0;
    return oneRM / (1 + targetReps / 30.0);
  }
  function adjustForRpe(weight, rpe) {
    let delta;
    if (rpe < 7) delta = 0.05;
    else if (rpe < 8) delta = 0.025;
    else if (rpe < 9) delta = 0.0;
    else if (rpe < 10) delta = -0.025;
    else delta = -0.05;
    return weight * (1 + delta);
  }

  // ---------- Tabs ----------
  const tabButtonsTop = document.querySelectorAll(".tab-btn");
  const navButtons = document.querySelectorAll(".nav-btn");
  const sections = {
    today: document.getElementById("section-today"),
    loads: document.getElementById("section-loads"),
    prs: document.getElementById("section-prs"),
    profile: document.getElementById("section-profile"),
  };

  function setActiveTab(tab) {
    Object.values(sections).forEach(s => s.classList.remove("active"));
    sections[tab].classList.add("active");

    tabButtonsTop.forEach(btn => {
      btn.classList.toggle("active", btn.dataset.tab === tab);
    });
    navButtons.forEach(btn => {
      btn.classList.toggle("active", btn.dataset.tab === tab);
    });
  }

  tabButtonsTop.forEach(btn => {
    btn.addEventListener("click", () => setActiveTab(btn.dataset.tab));
  });
  navButtons.forEach(btn => {
    btn.addEventListener("click", () => setActiveTab(btn.dataset.tab));
  });

  // ---------- Hoy ----------
  const energyInput = document.getElementById("energy");
  const stressInput = document.getElementById("stress");
  const sleepInput = document.getElementById("sleep");
  const energyVal = document.getElementById("energy-val");
  const stressVal = document.getElementById("stress-val");
  const sleepVal = document.getElementById("sleep-val");
  const suggestionEl = document.getElementById("suggestion");

  function updateSuggestion() {
    const e = parseFloat(energyInput.value);
    const s = parseFloat(stressInput.value);
    const sl = parseFloat(sleepInput.value);
    const score = e - s + sl;
    let text;
    if (score < 2) {
      text = "D√≠a pesado ‚Üí manten√© cargas o baja un poco el volumen.";
    } else if (score <= 4) {
      text = "D√≠a neutro ‚Üí entreno normal, sin volverse loco.";
    } else {
      text = "D√≠a bueno ‚Üí pod√©s intentar subir un poco las cargas.";
    }
    suggestionEl.textContent = text;
  }

  [energyInput, stressInput, sleepInput].forEach(input => {
    input.addEventListener("input", () => {
      if (input === energyInput) energyVal.textContent = input.value;
      if (input === stressInput) stressVal.textContent = input.value;
      if (input === sleepInput) sleepVal.textContent = input.value;
      updateSuggestion();
    });
  });
  updateSuggestion();

  // ---------- Cargas ----------
  const exerciseInput = document.getElementById("exercise");
  const weightInput = document.getElementById("weight");
  const repsInput = document.getElementById("reps");
  const rpeInput = document.getElementById("rpe");
  const rpeVal = document.getElementById("rpe-val");
  const targetRepsInput = document.getElementById("targetReps");
  const btnCalc = document.getElementById("btn-calc");
  const rmResult = document.getElementById("rm-result");
  const targetResult = document.getElementById("target-result");
  const btnSavePr = document.getElementById("btn-save-pr");
  const saveMsg = document.getElementById("save-msg");

  rpeInput.addEventListener("input", () => {
    rpeVal.textContent = rpeInput.value;
  });

  btnCalc.addEventListener("click", () => {
    const w = parseFloat(weightInput.value.replace(",", "."));
    const r = parseInt(repsInput.value, 10);
    const t = parseInt(targetRepsInput.value, 10);
    const rpe = parseFloat(rpeInput.value);

    if (!w || !r || r <= 0) {
      rmResult.textContent = "Complet√° peso y reps para ver tu 1RM.";
      targetResult.textContent = "";
      return;
    }
    const rm = oneRepMax(w, r);
    rmResult.innerHTML = `1RM estimado: <strong>${rm.toFixed(1)} kg</strong>`;

    if (t && t > 0) {
      let targetW = weightForReps(rm, t);
      targetW = adjustForRpe(targetW, rpe);
      targetResult.innerHTML =
        `Peso sugerido: <strong>${targetW.toFixed(1)} kg</strong> (ajustado por RPE)`;
    } else {
      targetResult.textContent = "";
    }
  });

  // ---------- PR + sets / almacenamiento ----------
  const PR_KEY = "gymload_prs_v1";
  const SETS_KEY = "gymload_sets_v1";
  let prs = [];
  let sets = [];

  function loadPRs() {
    try {
      const raw = localStorage.getItem(PR_KEY);
      if (!raw) return;
      prs = JSON.parse(raw);
    } catch (e) {
      prs = [];
    }
  }

  function savePRs() {
    localStorage.setItem(PR_KEY, JSON.stringify(prs));
  }

  function loadSets() {
    try {
      const raw = localStorage.getItem(SETS_KEY);
      if (!raw) return;
      sets = JSON.parse(raw);
    } catch (e) {
      sets = [];
    }
  }

  function saveSets() {
    localStorage.setItem(SETS_KEY, JSON.stringify(sets));
  }

  const historyFilter = document.getElementById("history-filter");

  function refreshHistoryFilterOptions() {
    if (!historyFilter) return;
    const currentValue = historyFilter.value || "all";
    const exercises = Array.from(new Set(sets.map(s => s.exercise))).sort((a,b) => a.localeCompare(b));
    historyFilter.innerHTML = '<option value="all">Todos</option>';
    exercises.forEach(name => {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;
      historyFilter.appendChild(opt);
    });
    if (exercises.includes(currentValue)) {
      historyFilter.value = currentValue;
    } else {
      historyFilter.value = "all";
    }
  }

  function updatePRListUI() {
    const prListEl = document.getElementById("pr-list");
    const prEmptyEl = document.getElementById("pr-empty");
    prListEl.innerHTML = "";

    if (!prs.length) {
      prEmptyEl.style.display = "block";
      return;
    }
    prEmptyEl.style.display = "none";

    const groups = {};
    prs.forEach(pr => {
      if (!groups[pr.exercise]) groups[pr.exercise] = [];
      groups[pr.exercise].push(pr);
    });

    Object.keys(groups).sort().forEach(ex => {
      const group = groups[ex].sort((a,b) => a.reps - b.reps);
      const header = document.createElement("div");
      header.style.marginTop = "0.5rem";
      header.innerHTML = `<div class="badge">üèãÔ∏è‚Äç‚ôÇÔ∏è ${ex}</div>`;
      prListEl.appendChild(header);

      group.forEach(pr => {
        const item = document.createElement("div");
        item.className = "pr-item";
        const date = new Date(pr.date);
        const dateStr = `${date.getDate().toString().padStart(2,"0")}/${(date.getMonth()+1).toString().padStart(2,"0")}/${date.getFullYear()}`;
        item.innerHTML = `
          <div>
            <div>${pr.reps} reps ¬∑ <strong>${pr.weight.toFixed(1)} kg</strong></div>
            <div class="small">${dateStr}</div>
          </div>
          <div class="small">1RM ‚âà ${oneRepMax(pr.weight, pr.reps).toFixed(1)} kg</div>
        `;
        prListEl.appendChild(item);
      });
    });
  }

  function updateHistoryUI() {
    const historyList = document.getElementById("history-list");
    const historyEmpty = document.getElementById("history-empty");
    historyList.innerHTML = "";

    if (!sets.length) {
      historyEmpty.textContent = "Todav√≠a no registraste ninguna serie.";
      historyEmpty.style.display = "block";
      return;
    }

    const filterValue = historyFilter ? historyFilter.value : "all";

    const sorted = [...sets].sort((a, b) => new Date(b.date) - new Date(a.date));
    const filteredAll = filterValue === "all"
      ? sorted
      : sorted.filter(s => s.exercise === filterValue);

    if (!filteredAll.length) {
      historyEmpty.textContent = "No hay series todav√≠a para ese ejercicio.";
      historyEmpty.style.display = "block";
      return;
    }
    historyEmpty.style.display = "none";

    const limited = filteredAll.slice(0, 80);

    const groups = {};
    limited.forEach(s => {
      const d = new Date(s.date);
      const dayKey = d.toISOString().slice(0,10);
      if (!groups[dayKey]) groups[dayKey] = [];
      groups[dayKey].push(s);
    });

    const dayKeys = Object.keys(groups).sort((a,b) => (a < b ? 1 : -1));

    dayKeys.forEach(dayKey => {
      const [y,m,d] = dayKey.split("-");
      const daySets = groups[dayKey];

      const header = document.createElement("div");
      header.style.marginTop = "0.5rem";
      header.innerHTML = `<div class="badge">üìÖ ${d.padStart(2,"0")}/${m.padStart(2,"0")}/${y}</div>`;
      historyList.appendChild(header);

      // Resumen del d√≠a (seg√∫n filtro)
      const totalVolume = daySets.reduce((sum,s) => sum + s.weight * s.reps, 0);
      const totalSets = daySets.length;
      const heavySets = daySets.filter(s => s.rpe && s.rpe >= 8.5).length;
      const summary = document.createElement("div");
      summary.className = "small";
      summary.style.marginBottom = "0.2rem";
      summary.textContent =
        `Volumen: ${totalVolume.toFixed(1)} kg ¬∑ Series: ${totalSets} ¬∑ Series pesadas: ${heavySets}`;
      historyList.appendChild(summary);

      daySets.forEach(s => {
        const item = document.createElement("div");
        item.className = "pr-item";
        const dt = new Date(s.date);
        const timeStr = `${dt.getHours().toString().padStart(2,"0")}:${dt.getMinutes().toString().padStart(2,"0")}`;
        const rpeText = s.rpe ? ` ¬∑ RPE ${s.rpe.toFixed(1)}` : "";
        item.innerHTML = `
          <div>
            <div><strong>${s.exercise}</strong></div>
            <div class="small">${s.weight.toFixed(1)} kg ¬∑ ${s.reps} reps${rpeText}</div>
          </div>
          <div class="small">${timeStr}</div>
        `;
        historyList.appendChild(item);
      });
    });
  }

  function addSet(exercise, weight, reps, rpe) {
    const now = new Date();
    sets.push({
      exercise,
      weight,
      reps,
      rpe: rpe || null,
      date: now.toISOString()
    });

    if (sets.length > 1000) {
      sets = sets.slice(sets.length - 1000);
    }
    saveSets();
    refreshHistoryFilterOptions();
    updateHistoryUI();
  }

  function saveAsPRAndSet() {
    const name = (exerciseInput.value || "").trim();
    const w = parseFloat(weightInput.value.replace(",", "."));
    const r = parseInt(repsInput.value, 10);
    const rpe = parseFloat(rpeInput.value);

    if (!name || !w || !r || r <= 0) return;

    // Guardar serie en historial
    addSet(name, w, r, rpe);

    // Guardar / actualizar PR
    const now = new Date();
    const existingIndex = prs.findIndex(
      pr => pr.exercise.toLowerCase() === name.toLowerCase() && pr.reps === r
    );

    if (existingIndex >= 0) {
      if (w > prs[existingIndex].weight) {
        prs[existingIndex].weight = w;
        prs[existingIndex].date = now.toISOString();
        saveMsg.textContent = "Actualizaste tu PR para ese ejercicio/reps. üèÖ";
      } else {
        saveMsg.textContent = "Serie guardada. Ya ten√©s un PR igual o mayor para esas reps.";
      }
    } else {
      prs.push({
        exercise: name,
        reps: r,
        weight: w,
        date: now.toISOString()
      });
      saveMsg.textContent = "Serie guardada como posible PR. üèÖ";
    }

    savePRs();
    updatePRListUI();
    setTimeout(() => { saveMsg.textContent = ""; }, 2500);
  }

  btnSavePr.addEventListener("click", saveAsPRAndSet);

  loadPRs();
  loadSets();
  refreshHistoryFilterOptions();
  updatePRListUI();
  updateHistoryUI();

  if (historyFilter) {
    historyFilter.addEventListener("change", updateHistoryUI);
  }

  // ---------- Tema ----------
  const appEl = document.getElementById("app");
  const THEME_KEY = "gymload_theme";
  function applyTheme(theme) {
    appEl.setAttribute("data-theme", theme);
  }
  function loadTheme() {
    const t = localStorage.getItem(THEME_KEY) || "dark";
    applyTheme(t);
  }
  function saveTheme(t) {
    localStorage.setItem(THEME_KEY, t);
  }
  loadTheme();

  document.querySelectorAll("[data-theme-btn]").forEach(btn => {
    btn.addEventListener("click", () => {
      const t = btn.dataset.themeBtn;
      applyTheme(t);
      saveTheme(t);
    });
  });

  // ---------- Recordatorio simple ----------
  const REM_KEY = "gymload_reminder_time";
  const reminderInput = document.getElementById("reminder-time");

  function loadReminder() {
    const t = localStorage.getItem(REM_KEY);
    if (t) reminderInput.value = t;
  }
  function saveReminder() {
    localStorage.setItem(REM_KEY, reminderInput.value);
  }
  loadReminder();
  reminderInput.addEventListener("change", saveReminder);
</script>
</body>
</html>
